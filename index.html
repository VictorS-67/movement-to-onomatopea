<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movement description using onomatopoeia</title>
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            text-align: center;
        }
        .video-container {
            margin-bottom: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            overflow: hidden; /* To contain rounded corners of video */
        }
        #myVideo {
            width: auto;
            height: auto;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 1rem;
        }
        .input-group label {
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #374151;
            text-align: left;
        }
        .input-group input, .input-group textarea {
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }
        .input-group textarea {
            resize: vertical;
            min-height: 4rem;
        }
        .button {
            padding: 0.75rem 1.5rem;
            background-color: #4f46e5;
            color: #fff;
            font-weight: 600;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-size: 1rem;
            margin: 0.5rem 0;
        }
        .button:hover {
            background-color: #4338ca;
        }
        #timestampDisplay {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #6b7280;
        }
    </style>
</head>

    

    

    
<body class="bg-gray-100">
    
    <div class="container">        
        
        <div class="input-group">
            <label for="nameInput">Your name:</label>
            <textarea id="nameInput" name="nameInput" placeholder="Your name"></textarea>
        </div>

        <!-- Video -->
        <p id="videoTitle">Video 1.mp4</p>
        <div class="video-container">
            <!--
            <iframe
                id="myVideo"
                src="https://drive.google.com/file/d/1wONpmPkKvBX0gaUiFI9tY2ielxd415fh/preview" 
                width="640" 
                height="480" 
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                allowfullscreen
                title="point light motion"
            ></iframe>
            -->
            <video
                id="myVideo"
                src="videos/1.mp4" 
                controls
                title="point light motion"
            >
                Your browser does not support the video tag.
            </video>
        </div>

        <!-- Dropdown to Select Video -->
        <div class="dropdown">
            <label for="videoSelect">Change the video:</label>
            <select id="videoSelect">
            </select>
        </div>

        <div id="message" class="mt-4 text-gray-700"></div>

        <!-- Onomatopoeia -->
        <div class="input-group">
            <label for="onomatopoeiaInput">Onomatopoeia:</label>
            <textarea id="onomatopoeiaInput" name="onomatopoeiaInput" placeholder="Write your onomatopoeia"></textarea>
        </div>
        <p>To log the start (end) time of the onomatopoeia, please pause the video at the start (end) of the movement corresponding to the onomatopoeia. Then click on the "Get starting (ending) time" button.</p>

        <button id="getStart" class="button">Get starting time</button>
        <p>Onomatopoeia Start Time:</p>
        <p id="startDisplay">-.--</p>

        <button id="getEnd" class="button">Get ending time</button>
        <p>Onomatopoeia End Time:</p>
        <p id="endDisplay">-.--</p>

        <button id="saveOnomatopoeia" class="button">Save Onomatopoeia</button>
        <!-- With this one, we want to save the onomatopoeia, start time and end time (in csv ?) and reset those values
        Also want to display message like onomatopoeia "..." 1:3 -> 2:4 saved correctly 
        Also put videoPlayer back to 0-->

        <h3>Onomatopoeia already saved for this video:</h3>
        <p id="recordOnomatopoeia">None</p>
        <p id="output"></p>


    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <script>
        const nameInput = document.getElementById("nameInput");
        const videoTitle = document.getElementById("videoTitle");
        const videoPlayer = document.getElementById("myVideo");
        const videoSelect = document.getElementById('videoSelect');
        const getStart = document.getElementById("getStart");
        const startDisplay = document.getElementById("startDisplay");
        const getEnd = document.getElementById("getEnd");
        const endDisplay = document.getElementById("endDisplay");
        const onomatopoeiaInput = document.getElementById("onomatopoeiaInput");
        const saveOnomatopoeiaButton = document.getElementById("saveOnomatopoeia");
        const messageDisplay = document.getElementById("message");
        const recordOnomatopoeia = document.getElementById("recordOnomatopoeia");

        let record = []; // Array to store recorded Onomatopoeia

        async function fetchCSV(url) {
            try {
                const response = await fetch(url);
                console.log(response)
                const data = await response.text();
                console.log(data)
            } catch (error) {
                console.error('Error fetching CSV:', error);
            }
            return data;
        }

        const csvData = fetchCSV('./data.csv');
        if (csvData) {
            Papa.parse(csvData, {
                header: true,
                complete: function(results) {
                    console.log(results.data)
                    document.getElementById('output').innerText = JSON.stringify(results.data, null, 2);
                },
                error: function(error) {
                    console.error('Error parsing CSV:', error);
                }
            });
        }

        function resetDisplay(record) {
            onomatopoeiaInput.value = "";
            startDisplay.textContent = "-.--";
            endDisplay.textContent = "-.--";

            if (record == []) {
                recordMessage = "None";
            } else {
                recordMessage = "";
                record.forEach(elt => {
                    recordMessage += "\n" + elt ;
                });
            }
            recordOnomatopoeia.textContent = recordMessage;
        }

        // function to fetch the list of video files
        const fetchFilesInFolder = async () => {
          const owner = "VictorS-67"; // GitHub username
          const repo = "movement-to-onomatopoeia"; // Repository name
          const folder = "videos"; // Folder path
        
          const url = `https://api.github.com/repos/${owner}/${repo}/contents/${folder}`;
        
          try {
            const response = await fetch(url, {
              headers: {
                Accept: "application/vnd.github.v3+json",
              },
            });
        
            if (!response.ok) {
              throw new Error(`Failed to fetch files: ${response.statusText}`);
            }
        
            const files = await response.json();
        
            // Filter and return the files as an array of filenames
            const fileList = files
              .filter(file => file.type === "file")
              .map(file => file.name); // Extract only the file names
        
            return fileList; // Return the list of files
          } catch (error) {
            console.error("Error:", error.message);
            return []; // Return an empty array in case of error
          }
        };
    
        // Populate the dropdown dynamically
        fetchFilesInFolder().then(videos => {
            videos.forEach(video => {
                const option = document.createElement("option");
                option.value = `videos/${video}`;
                option.textContent = video; // Display the video filename
                videoSelect.appendChild(option);
            });
        }).catch(error => {
            console.error("Error populating dropdown:", error);
        });
    
        // Update video source when dropdown changes
        videoSelect.addEventListener("change", () => {
            videoPlayer.src = videoSelect.value;
            videoPlayer.load();
            videoTitle.textContent = `Video: ${videoSelect.value}`;
            resetDisplay(record)
        });

        
        // Function to get and display the current timestamp
        getStart.addEventListener("click", () => {
            const currentTime = videoPlayer.currentTime;
            startDisplay.textContent = `${currentTime.toFixed(2)}`;
        });

        getEnd.addEventListener("click", () => {
            const currentTime = videoPlayer.currentTime;
            endDisplay.textContent = `${currentTime.toFixed(2)}`;
        });

        

        // when save button is clicked
        saveOnomatopoeiaButton.addEventListener("click", () => {
            const onomatopoeia = onomatopoeiaInput.value.trim();
            const name = nameInput.value.trim();
            const startTime = startDisplay.textContent;
            const endTime = endDisplay.textContent;

            if (onomatopoeia === "") {
                messageDisplay.textContent = "Please enter your onomatopoeia.";
                messageDisplay.style.color = "red";
                return;
            }

            if (name === "") {
                messageDisplay.textContent = "Please enter your name.";
                messageDisplay.style.color = "red";
                return;
            }

            if (startTime === "-.--") {
                messageDisplay.textContent = "Please record the start of the onomatopoeia.";
                messageDisplay.style.color = "red";
                return;
            }

            if (endTime === "-.--") {
                messageDisplay.textContent = "Please record the end of the onomatopoeia.";
                messageDisplay.style.color = "red";
                return;
            }

            // Create an object to store the timestamp and opinion
            const opinionData = {
                startTime: startTime,
                endTime: endTime,
                onomatopoeia: onomatopoeia,
            };

            // Display a success message
            messageDisplay.textContent = "Onomatopoeia and start-end saved!";
            messageDisplay.style.color = "green";

            record.push(onomatopoeia + " from " + startTime + " to " +  endTime)

            resetDisplay(record) // Clear display after saving
            // You can optionally save the opinions to a server here using fetch()
            // Example of sending data to a server (you'll need a server-side script to handle this):
            /*
            fetch('/save-opinion', {  //  Replace '/save-opinion' with your server endpoint
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(opinionData),
            })
            .then(response => {
                if (response.ok) {
                    messageDisplay.textContent = "Opinion and timestamp saved to server!";
                    messageDisplay.style.color = "green";
                } else {
                    messageDisplay.textContent = "Error saving opinion. Please try again.";
                    messageDisplay.style.color = "red";
                }
            })
            .catch(error => {
                console.error('Error:', error);
                messageDisplay.textContent = "Error saving opinion. Please check your network connection.";
                messageDisplay.style.color = "red";
            });
            */
        });


            
    </script>
</body>
</html>
